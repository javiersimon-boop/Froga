<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Albisteak | Noticias - San Vicente de Pa煤l Irun</title>
    
    <!-- FUENTES -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- ESTILOS PROPIOS -->
    <link rel="stylesheet" href="styles.css">

    <!-- TAILWIND CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'sv-primary': '#006D7B',
                        'sv-accent-1': '#5FB3C5',
                        'sv-accent-2': '#95C11F',
                        'sv-accent-3': '#FDC300',
                        'sv-cta': '#F3953F',
                        'sv-light': '#F9FAFB',
                    },
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* Animaciones */
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-white text-gray-800 font-sans">

    <!-- NAV -->
    <nav class="bg-white shadow-md fixed w-full z-50">
        <div class="max-w-7xl mx-auto px-4 h-20 flex items-center justify-between">
            <a href="index.html" class="font-bold text-sv-primary text-lg uppercase flex items-center gap-2">
                <svg class="h-8 w-auto" viewBox="0 0 100 100" fill="none" stroke="currentColor" stroke-width="3">
                   <path d="M30 40 Q35 10 50 25 Q65 10 70 40" />
                   <path d="M35 35 Q40 15 50 30 Q60 15 65 35" />
                   <path d="M50 90 C20 70 10 50 10 35 A 20 20 0 0 1 90 35 C90 50 80 70 50 90 Z" />
                </svg>
                San Vicente de Pa煤l
            </a>
            <div class="hidden md:flex space-x-6 text-xs uppercase font-bold text-gray-500">
                <a href="index.html" class="hover:text-sv-primary">Hasiera / Inicio</a>
                <a href="#" class="text-sv-primary">Albisteak / Noticias</a>
            </div>
        </div>
    </nav>

    <!-- HERO -->
    <header class="relative bg-sv-primary h-64 flex items-center justify-center pt-20 overflow-hidden">
        <div class="absolute inset-0 opacity-20">
            <!-- Imagen de fondo gen茅rica para noticias -->
            <img src="https://images.unsplash.com/photo-1504711434969-e33886168f5c?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80" class="w-full h-full object-cover">
        </div>
        <div class="relative z-10 text-center px-4">
            <h1 class="text-4xl md:text-5xl font-bold text-white mb-2">Gaurkotasuna</h1>
            <div class="w-16 h-1 bg-sv-accent-2 mx-auto my-3"></div>
            <p class="text-white text-xl font-medium tracking-wide opacity-90">Actualidad y Noticias</p>
        </div>
    </header>

    <!-- MAIN GRID -->
    <main class="max-w-7xl mx-auto px-4 py-16">
        
        <!-- Contenedor de Noticias -->
        <div id="full-news-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- Loader inicial -->
            <div class="col-span-full text-center py-20">
                <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-sv-primary border-t-transparent"></div>
                <p class="mt-4 text-gray-500">Kargatzen / Cargando...</p>
            </div>
        </div>

    </main>

    <!-- FOOTER -->
    <footer class="bg-white border-t border-gray-100 py-8 text-center text-xs text-gray-500">
        &copy; 2025 Colegio San Vicente de Pa煤l Irun.
    </footer>

    <!-- SCRIPT -->
    <script>
        // URL de tu Hoja de C谩lculo
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRH7yAF9u3eguKbDSemxaDviakRJMDMGNxTSe6U86ZO8poS6wZAIpN3JJhSvOxTBnyYWeif1ZhY6x33/pub?output=csv'; 
        
        const grid = document.getElementById('full-news-grid');

        async function loadAllNews() {
            try {
                const response = await fetch(SHEET_URL);
                if (!response.ok) throw new Error("Error de conexi贸n");
                const data = await response.text();
                let newsItems = parseCSV(data);
                
                grid.innerHTML = ''; // Limpiar loader

                if (newsItems.length === 0) {
                    grid.innerHTML = '<p class="text-center col-span-full text-gray-500">Ez dago berririk / No hay noticias.</p>';
                    return;
                }

                // Mostrar TODAS las noticias, ordenadas de m谩s reciente a m谩s antigua (Reverse)
                newsItems.reverse().forEach(news => {
                    grid.insertAdjacentHTML('beforeend', createCardHTML(news));
                });

            } catch (error) {
                console.warn("Error cargando noticias:", error);
                grid.innerHTML = '<p class="text-center col-span-full text-red-500">Errorea datuak kargatzean. / Error al cargar datos.</p>';
                
                // Fallback para demostraci贸n si falla la conexi贸n
                setTimeout(() => {
                   grid.innerHTML = '';
                   // Generamos 3 noticias de ejemplo con y sin imagen
                   const demoData = [
                       { mes: 'URR', dia: '28', titulo_es: 'Celebraci贸n del D铆a de la Innovaci贸n', titulo_eu: 'Berrikuntzaren Egunaren Ospakizuna', resumen_es: 'Nuestros alumnos presentaron proyectos de rob贸tica.', resumen_eu: 'Ikasleek robotika proiektuak aurkeztu zituzten.', enlace: '#', imagen: 'https://images.unsplash.com/photo-1531482615713-2afd69097998?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80' },
                       { mes: 'URR', dia: '22', titulo_es: 'Intercambio Cultural', titulo_eu: 'Kultur Trukea', resumen_es: 'Recibimos a estudiantes de Francia.', resumen_eu: 'Frantziako ikasleak jaso ditugu.', enlace: '#', imagen: '' }, // Sin imagen
                       { mes: 'AZA', dia: '15', titulo_es: 'Semana de la Ciencia', titulo_eu: 'Zientzia Astea', resumen_es: 'Actividades en todos los niveles.', resumen_eu: 'Ekintzak maila guztietan.', enlace: '#', imagen: 'https://images.unsplash.com/photo-1532094349884-543bc11b234d?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80' }
                   ];
                   
                   demoData.forEach(news => grid.insertAdjacentHTML('beforeend', createCardHTML(news))); 
                }, 1000);
            }
        }

        // Parser CSV (Mismo que en index.html)
        function parseCSV(str) {
            const rows = str.trim().split('\n');
            // Saltamos cabecera (fila 0)
            return rows.slice(1).map(row => {
                const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                const cleanCols = cols.map(col => col.replace(/^"|"$/g, '').trim());
                
                if (cleanCols.length < 5) return null;

                return {
                    mes: cleanCols[0],
                    dia: cleanCols[1],
                    titulo_eu: cleanCols[2],
                    resumen_eu: cleanCols[3],
                    titulo_es: cleanCols[4],
                    resumen_es: cleanCols[5],
                    enlace: cleanCols[6] || '#',
                    imagen: cleanCols[7] || '' // Columna H (铆ndice 7) para la imagen
                };
            }).filter(n => n);
        }

        // Generador de Tarjeta HTML
        function createCardHTML(news) {
            // L贸gica para mostrar bot贸n si hay enlace externo
            const hasLink = news.enlace && news.enlace !== '#' && news.enlace.trim() !== '';
            
            const linkButton = hasLink 
                ? `<a href="${news.enlace}" target="_blank" class="block w-full text-center bg-sv-light text-sv-primary font-bold py-2 rounded hover:bg-sv-primary hover:text-white transition text-sm mb-2 border border-sv-primary/10">
                     Jatorrizkoa Ikusi / Ver Original
                   </a>` 
                : '';

            // L贸gica de Imagen: Si existe, se muestra arriba. Si no, cabecera de color.
            let headerHTML = '';
            if (news.imagen && news.imagen.trim() !== '') {
                headerHTML = `
                <div class="h-48 overflow-hidden relative group-hover:opacity-90 transition">
                    <img src="${news.imagen}" alt="${news.titulo_es}" class="w-full h-full object-cover transform group-hover:scale-105 transition duration-700">
                    <div class="absolute top-0 right-0 bg-white/90 backdrop-blur-sm text-sv-primary px-3 py-2 m-3 rounded-lg shadow-sm text-center min-w-[60px]">
                        <span class="block text-xl font-bold leading-none">${news.dia}</span>
                        <span class="block text-xs font-bold uppercase">${news.mes}</span>
                    </div>
                </div>`;
            } else {
                 headerHTML = `
                 <div class="bg-sv-primary p-6 text-white flex justify-between items-center relative overflow-hidden">
                    <!-- Decoraci贸n de fondo -->
                    <div class="absolute -right-4 -top-4 text-white/10">
                        <svg class="w-24 h-24" fill="currentColor" viewBox="0 0 24 24"><path d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/></svg>
                    </div>
                    <div>
                        <span class="block text-4xl font-bold">${news.dia}</span>
                        <span class="block text-sm font-medium opacity-80 uppercase tracking-wide">${news.mes}</span>
                    </div>
                </div>`;
            }

            return `
            <div class="bg-white rounded-xl shadow-md border border-gray-100 overflow-hidden hover:shadow-2xl hover:-translate-y-1 transition-all duration-300 flex flex-col group fade-in">
                
                ${headerHTML}
                
                <div class="p-6 flex-grow flex flex-col">
                    <!-- Castellano (Principal) -->
                    <h3 class="font-bold text-gray-900 text-lg mb-2 leading-tight">${news.titulo_es}</h3>
                    <p class="text-gray-600 text-sm mb-4 line-clamp-3 flex-grow">${news.resumen_es}</p>
                    
                    <div class="border-t border-gray-100 my-4"></div>
                    
                    <!-- Euskera (Secundario) -->
                    <h4 class="font-bold text-sv-primary text-base mb-1">${news.titulo_eu || ''}</h4>
                    <p class="text-gray-500 text-xs line-clamp-2 italic">${news.resumen_eu || ''}</p>
                </div>

                <!-- Botones -->
                <div class="p-6 pt-0 mt-auto">
                    ${linkButton}
                    <button onclick="shareItem('${news.titulo_es.replace(/'/g, "\\'")}', '${news.enlace}')" class="block w-full text-center border border-gray-200 text-gray-500 font-bold py-2 rounded hover:bg-gray-50 hover:text-sv-cta hover:border-sv-cta transition text-sm flex items-center justify-center gap-2">
                         <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/></svg>
                         Elkarbanatu / Compartir
                    </button>
                </div>
            </div>`;
        }

        // Funci贸n para compartir (Web Share API)
        window.shareItem = async (title, url) => {
             const shareData = {
                title: `San Vicente Irun: ${title}`,
                text: ` Noticia: ${title} (@svpaulirun)`,
                url: url && url !== '#' ? url : window.location.href
            };

            // Si el navegador soporta compartir nativo (m贸vil)
            if (navigator.share) {
                try { 
                    await navigator.share(shareData); 
                } catch (e) {
                    console.log('Compartir cancelado');
                }
            } else {
                // Fallback para escritorio: Copiar al portapapeles o alerta
                prompt("Copia este enlace para compartir:", shareData.url);
            }
        }

        // Cargar noticias al iniciar
        loadAllNews();
    </script>
</body>
</html>
